---
layout: post
title:  (æ•™å­¸) golang-http
date:   2023-08-27 06:00:00 +0800
image:  02.jpg
tags:   Tutorial
---

ä»Šå¤©æ¥è‘—ä»‹ç´¹ Golang éå¸¸å¼·å¤§çš„ std lib: HTTP

æˆ‘å€‘ç›´æ¥ä¸Š code

1. hello http
```go
package main

import (
	"fmt"
	"net/http"
)

const port = ":8887"

func main() {

  // å®šç¾©äº†è·¯ç”±, ç„¶å¾Œè™•ç†å‡½å¼
	http.HandleFunc("/hello", Hello)

  // å…ˆå°å€‹æç¤ºè¨Šæ¯
	fmt.Println("listening: " + port)
	// ç›£è½ port :8887, ç¬¬äºŒå€‹åƒæ•¸å¯ä»¥è‡ªè¨‚æ›´è©³ç´°çš„ http è™•ç†å‡½å¼, ç‚ºäº†ç°¡åŒ–å…ˆä¸è©³è¿°
  http.ListenAndServe(port, nil)
}

func Hello(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintln(w, "hello world")
}
```
å¯ä»¥æ‰“é–‹ curl `curl localhost:8887/hello`, åšå€‹ç°¡å–®æ¸¬è©¦, go è¦èµ·å€‹ç°¡å–®çš„ http server å°±æ˜¯å¦‚æ­¤å®¹æ˜“

ä»¥ä¸Šå°è©¦èº«æ‰‹ä¸€ä¸‹, æ¥è‘—æˆ‘å€‘å¯¦å‹™ä¸€é»çš„æƒ…æ³å»è™•ç†


2. basic http
```go
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"net/http"
)

const port = ":8887"

func main() {

	// é€™é‚Šæˆ‘å€‘æ”¹æ¨¡æ“¬å€‹ login api
	http.HandleFunc("/login", Login)

	// ç¤ºç¯„æ€éº¼å¿«é€ŸæŠŠéœæ…‹æª”æ¡ˆæä¾›å‡ºå»
	http.Handle("/", http.FileServer(http.Dir("public")))

	fmt.Println("listening: " + port)
	// é€™é‚Šåšå€‹éŒ¯èª¤æ•æ‰, æœ‰æ™‚å€™è‡ªå·±portè¢«ä½”åˆ°ä¸è‡ªçŸ¥, æœ‰éŒ¯èª¤è¨Šæ¯å°±æ¯”è¼ƒçœæ™‚é–“
	err := http.ListenAndServe(port, nil)
	if err != nil {
		log.Fatal(err)
	}
}

// ç¿’æ…£ä¸Šæœƒå…ˆç”¨å€‹ struct èµ·ä¾†æ¥è³‡æ–™
type userParam struct {
	Email    string `json:"email"`
	Password string `json:"password"`
}

func Login(w http.ResponseWriter, r *http.Request) {

	// ç”±æ–¼å…§å»ºæ²’æœ‰æ•æ‰ method, æˆ‘å€‘è‡ªå·±å¯«
	if r.Method != "POST" {
		w.WriteHeader(http.StatusBadRequest)
		fmt.Fprintf(w, "method not allowed")
		return
	}

	// é€™é‚Šé–‹å§‹è§£æ bodyè³‡æ–™, å€‹äººæ˜¯æ»¿å–œæ­¡ json decode/encode é€™ç¨®æ–¹å¼
	user := userParam{}
	err := json.NewDecoder(r.Body).Decode(&user)
	if err != nil {
		w.WriteHeader(http.StatusBadRequest)
		fmt.Fprintf(w, "data error, please try again")
		return
	}
	// é€™é‚Š log å‡ºä¾†çœ‹, è³‡æ–™å¯¦éš›æœ‰æ¥æ”¶åˆ°
	fmt.Printf("%+v", user)

	// é€™é‚Šè¨­å®šå€‹ headers
	w.Header().Set("Content-Type", "application/json")
	// é€™é‚ŠæŠŠ w æ‹¿å»åš encoder, è³‡æ–™å°±æœƒç›´æ¥å‡ºå»äº†
	err = json.NewEncoder(w).Encode(user)
	if err != nil {
		w.WriteHeader(http.StatusBadRequest)
		fmt.Fprintf(w, "json encode failed")
		return
	}

}

```
ç¬¬äºŒç¨®æˆ‘å€‘åšäº†æ›´å¤šç¤ºç¯„, æœ‰æä¾›éœæ…‹æª”æ¡ˆ, æœ‰æŠŠ post body è³‡æ–™æ“·å–ä¸‹ä¾†, ä¸¦ä¸”ç”¨ json å›å‚³, å¯«èµ·ä¾†èˆ’æœå› ç‚ºä¸ç”¨ä¾è³´å¤ªå¤šæ±è¥¿, ä½†å¯«ä¹…äº†é‚„æ˜¯æƒ³å·æ‡¶æ€è¾¦, è«‹åƒè€ƒç¬¬ä¸‰ç¨® 


3. [fiber](https://github.com/gofiber/fiber) http
```go
package main

import (
	"fmt"
	"log"

	"github.com/gofiber/fiber/v2"
	"github.com/gofiber/fiber/v2/middleware/cors"
	"github.com/gofiber/fiber/v2/middleware/logger"
	"github.com/gofiber/fiber/v2/middleware/recover"
)

func main() {
	app := fiber.New()

  // å°è£å¥½çš„å„å¼ä¸­é–“ä»¶, æˆ‘å€‘å°±ä¸éœ€è¦è‡ªå·±å¯«äº†ï¼ 
	app.Use(cors.New())    // cors allow *
	app.Use(logger.New())  // logger middleware
	app.Use(recover.New()) // recover middleware

  // æœ€å¤§çš„å¥½è™•, ç›´æ¥ serve å‡ºä¾†å°±æ˜¯ SPA äº†, æ–¹ä¾¿ï¼
	app.Static("/", "public")

	app.Get("/hello", Hello)

  // æœ‰ method åˆ†é¡å¯ä»¥ç”¨äº†ï¼
	app.Post("/login", Login)

	if err := app.Listen(":8887"); err != nil {
		log.Fatal(err)
	}
}

func Hello(c *fiber.Ctx) error {
	return c.SendString("Hello, World ğŸ‘‹!")
}

type userParam struct {
	Email    string `json:"email"`
	Password string `json:"password"`
}

func Login(c *fiber.Ctx) error {
	user := &userParam{}
  // body parser ä¹Ÿæ˜¯ç°¡ç°¡å–®å–®
	err := c.BodyParser(user)
	if err != nil {
		return c.Status(422).SendString("data error")
	}

	fmt.Printf("%+v", user)

  // å¾ˆèˆ’æœçš„å°±é€å›å»äº†
	return c.JSON(user)
}

```


æ¨è–¦é€²éšé–±è®€ï¼š
[7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶Geeæ•™ç¨‹](https://geektutu.com/post/gee.html)